generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid()) @db.Uuid
  type         UserType
  email        String?       @unique
  phones       Phone[]
  addresses    Address[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?
  anonymizedAt DateTime?  

  individual   Individual?
  company      Company?
  customer     Customer?
  supplier     Supplier?
}

model Individual {
  userId        String   @id @db.Uuid
  user          User     @relation(fields: [userId], references: [id])
  cpf           String   @unique
  fullName      String
  birthDate     DateTime?
  deletedAt     DateTime?
  anonymizedAt  DateTime?  
}

model Company {
  userId            String   @id @db.Uuid
  user              User     @relation(fields: [userId], references: [id])
  cnpj              String   @unique
  legalName         String
  tradeName         String?
  stateRegistration String?
  deletedAt         DateTime?
}

model Customer {
  userId  String   @id @db.Uuid
  user    User     @relation(fields: [userId], references: [id])
  deletedAt        DateTime?

  sales   Sale[]
  customerPrices CustomerProductPrice[]
}

model Supplier {
  userId       String   @id @db.Uuid
  deletedAt    DateTime?
  user         User     @relation(fields: [userId], references: [id])
  supplies     SupplyReceipt[]
}

model Address {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String   @db.Uuid
  street     String
  number     String
  district   String
  city       String
  state      String
  postalCode String
  country    String
  isPrimary  Boolean  @default(false)
  user       User     @relation(fields: [userId], references: [id])
}

enum PhoneType {
  FIXED
  MOBILE
}

model Phone {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String    @db.Uuid
  areaCode   String
  number     String
  isPrimary  Boolean   @default(false)
  isWhatsapp Boolean   @default(false)
  type       PhoneType 
  user       User      @relation(fields: [userId], references: [id])
}


model Product {
  id          String     @id @default(uuid()) @db.Uuid
  name        String
  description String?
  price       Decimal   @db.Decimal(10, 4)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  deletedAt   DateTime?
  sales       Sale[]
  customerPrices CustomerProductPrice[]
}

model Sale {
  id          String    @id @default(uuid()) @db.Uuid
  productId   String    @db.Uuid
  customerId  String    @db.Uuid
  quantity    Int
  unitPrice   Decimal   @db.Decimal(10, 4)
  totalPrice  Decimal   @db.Decimal(10, 4)
  saleDate    DateTime 
  receiptUrl  String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  deletedAt   DateTime?

  product     Product   @relation(fields: [productId], references: [id])
  customer    Customer  @relation(fields: [customerId], references: [userId])
}

model CustomerProductPrice {
  id          String    @id @default(uuid()) @db.Uuid
  customerId  String    @db.Uuid
  productId   String    @db.Uuid
  price       Decimal   @db.Decimal(10, 4)
  createdAt   DateTime  @default(now())

  customer    Customer  @relation(fields: [customerId], references: [userId])
  product     Product   @relation(fields: [productId], references: [id])

  @@unique([customerId, productId])
}


model SupplyType {
  id       String          @id @default(uuid()) @db.Uuid
  name     String          @unique
  supplies SupplyReceipt[]
}

model SupplyReceipt {
  id           String        @id @default(uuid()) @db.Uuid
  supplierId   String        @db.Uuid
  supplyTypeId String        @db.Uuid
  receivedDate DateTime
  quantity     Int
  unitPrice    Decimal       @db.Decimal(10, 4)
  totalPrice   Decimal       @db.Decimal(10, 4)
  createdAt    DateTime      @default(now())
  deletedAt    DateTime?

  supplier     Supplier      @relation(fields: [supplierId], references: [userId])
  supplyType   SupplyType    @relation(fields: [supplyTypeId], references: [id])
}

enum UserType {
  INDIVIDUAL
  COMPANY
}
